generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
  url      = env("NOTIFICATION_DATABASE_URL")
}

enum EmailStatus {
  QUEUED
  SENT
  FAILED
}

model EmailDelivery {
  id           String     @id @default(cuid())
  templateKey  String
  toEmail      String      @map("to_email") @db.VarChar(320)
  subject      String?
  context      Json
  status       EmailStatus @default(QUEUED)
  errorMessage String?     @map("error_message") @db.Text
  retryCount   Int         @default(0) @map("retry_count")
  sentAt       DateTime?   @map("sent_at") @db.Timestamptz(6)
  createdAt    DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([toEmail, createdAt], map: "idx_email_deliveries_to_created")
  @@index([status, createdAt], map: "idx_email_deliveries_status_created")
  @@map("email_deliveries")
}

model EmailTemplate {
  id        String   @id @default(cuid())
  key       String   @unique @db.VarChar(120)
  subject   String?  @db.VarChar(200)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@map("email_templates")
}
